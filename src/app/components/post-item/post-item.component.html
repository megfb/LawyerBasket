<div class="post-item">
  @if (showDeleteButton) {
    <span 
      class="material-symbols-outlined post-delete-icon"
      (click)="onDeletePost($event)"
      title="Sil"
    >delete</span>
  }
  <div class="post-header">
    <div class="post-author-avatar">
      @if (isLoadingAuthor) {
        <div class="avatar-placeholder"></div>
      } @else if (postAuthor) {
        <img
          [src]="'/img/profilephoto.jpg?userId=' + post.userId"
          [alt]="postAuthor.firstName + ' ' + postAuthor.lastName"
          class="author-avatar-image"
          (error)="onUserImageError($event)"
        />
      } @else {
        <div class="avatar-placeholder"></div>
      }
    </div>
    <div class="post-author-info">
      @if (isLoadingAuthor) {
        <div class="author-name-placeholder"></div>
      } @else if (postAuthor) {
        <p class="post-author-name">{{ postAuthor.firstName }} {{ postAuthor.lastName }}</p>
      } @else {
        <p class="post-author-name">Kullanıcı</p>
      }
      <span class="post-date">{{ formatDate(post.createdAt) }}</span>
    </div>
  </div>
  <div class="post-content">
    <p class="post-text">{{ post.content }}</p>
  </div>
  <div class="post-stats">
    <div class="stat-item">
      <span class="material-symbols-outlined stat-icon stat-item-clickable" [class.liked]="isLiked()" (click)="onToggleLike($event)">
        {{ isLiked() ? 'favorite' : 'favorite_border' }}
      </span>
      <span 
        class="stat-count" 
        [class.stat-count-clickable]="showLikeModal"
        (click)="onShowLikes($event)"
      >{{ getLikesCount() }}</span>
    </div>
    <div class="stat-item stat-item-clickable" (click)="onToggleComments($event)">
      <span class="material-symbols-outlined stat-icon">comment</span>
      <span class="stat-count">{{ getCommentsCount() }}</span>
    </div>
  </div>
  @if (expandedComments) {
    <div class="comments-section">
      <div class="comment-form-container">
        <form [formGroup]="commentForm" (ngSubmit)="onSubmitComment()">
          <div class="comment-input-wrapper">
            <textarea
              pInputTextarea
              formControlName="text"
              placeholder="Yorum yazın..."
              rows="2"
              [style]="{ width: '100%', resize: 'vertical' }"
              [class.ng-invalid]="commentForm.get('text')?.invalid && (commentForm.get('text')?.dirty || commentForm.get('text')?.touched)"
            ></textarea>
            <p-button
              label="Yorum Yap"
              icon="pi pi-send"
              type="submit"
              [loading]="isSubmittingComment"
              [disabled]="isSubmittingComment || commentForm.invalid"
              [style]="{ 'margin-top': '8px' }"
            ></p-button>
          </div>
          @if (commentForm.get('text')?.invalid && (commentForm.get('text')?.dirty || commentForm.get('text')?.touched)) {
            <small class="error-text">
              @if (commentForm.get('text')?.hasError('required')) {
                Bu alan zorunludur.
              } @else if (commentForm.get('text')?.hasError('maxlength')) {
                Maksimum 255 karakter olmalıdır.
              }
            </small>
          }
        </form>
      </div>
      @if (getComments().length === 0) {
        <p class="empty-comments-message">Henüz yorum yok.</p>
      } @else {
        <div class="comments-list">
          @for (comment of getComments(); track comment.id) {
            <div class="comment-item">
              <span 
                class="material-symbols-outlined comment-delete-icon"
                (click)="onDeleteComment($event, comment)"
                title="Sil"
              >delete</span>
              <div class="comment-header">
                <div class="comment-author-info">
                  <div class="comment-author-avatar">
                    @if (isLoadingCommentUsers || !getCommentUser(comment)) {
                      <div class="comment-avatar-placeholder"></div>
                    } @else {
                      <img
                        [src]="'/img/profilephoto.jpg?userId=' + comment.userId"
                        [alt]="getCommentUser(comment)!.firstName + ' ' + getCommentUser(comment)!.lastName"
                        class="comment-author-image"
                        (error)="onCommentImageError($event, comment)"
                      />
                    }
                  </div>
                  <div class="comment-author-details">
                    @if (isLoadingCommentUsers || !getCommentUser(comment)) {
                      <span class="comment-author-name-placeholder"></span>
                    } @else {
                      <span class="comment-author-name">{{ getCommentUser(comment)!.firstName }} {{ getCommentUser(comment)!.lastName }}</span>
                    }
                    <span class="comment-date">{{ formatDate(comment.createdAt) }}</span>
                  </div>
                </div>
              </div>
              <p class="comment-text">{{ comment.text }}</p>
            </div>
          }
        </div>
      }
    </div>
  }
</div>
<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>

