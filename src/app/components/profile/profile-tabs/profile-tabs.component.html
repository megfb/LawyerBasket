<p-card class="profile-tabs-card">
  <div class="tabs-container">
    <!-- Tab Headers -->
    <div class="tabs-header">
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'posts'"
        (click)="setActiveTab('posts')"
      >
        Gönderiler
      </button>
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'comments'"
        (click)="setActiveTab('comments')"
      >
        Yorumlar
      </button>
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'likes'"
        (click)="setActiveTab('likes')"
      >
        Beğeniler
      </button>
    </div>

    <!-- Tab Content -->
    <div class="tabs-content">
      @if (activeTab === 'posts') {
        <div class="tab-panel tab-panel-posts">
          @if (isLoadingPosts) {
            <div class="loading-container">
              <p-progressSpinner></p-progressSpinner>
              <p>Gönderiler yükleniyor...</p>
            </div>
          } @else if (postsError) {
            <div class="error-container">
              <p class="error-message">{{ postsError }}</p>
            </div>
          } @else if (posts.length === 0) {
            <p class="empty-message">Henüz gönderi yok.</p>
            @if (!isLoadingPosts && !postsError) {
              <button 
                class="new-post-button-fab"
                (click)="onShowCreatePostModal()"
                title="Yeni Gönderi"
              >
                <span class="material-symbols-outlined">add</span>
              </button>
            }
          } @else {
            <div class="posts-list">
              @for (post of displayedPosts; track post.id) {
                <app-post-item
                  [post]="post"
                  [showDeleteButton]="true"
                  [showLikeModal]="true"
                  (postDeleted)="onPostDeleted($event)"
                  (postLiked)="onPostLiked($event)"
                  (commentAdded)="onCommentAdded($event)"
                  (commentDeleted)="onCommentDeleted($event)"
                  (showLikes)="onShowLikes($event)"
                ></app-post-item>
              }
            </div>
            @if (hasMorePosts) {
              <div class="show-more-container">
                <p-button
                  label="Daha Fazla Göster"
                  icon="pi pi-arrow-right"
                  iconPos="right"
                  [outlined]="true"
                  (onClick)="onShowMorePosts()"
                  class="show-more-button"
                ></p-button>
              </div>
            }
            @if (!isLoadingPosts && !postsError) {
              <button 
                class="new-post-button-fab"
                (click)="onShowCreatePostModal()"
                title="Yeni Gönderi"
              >
                <span class="material-symbols-outlined">add</span>
              </button>
            }
          }
        </div>
      }
      
      @if (activeTab === 'comments') {
        <div class="tab-panel tab-panel-posts">
          @if (isLoadingCommentedPosts) {
            <div class="loading-container">
              <p-progressSpinner></p-progressSpinner>
              <p>Yorum yaptığınız gönderiler yükleniyor...</p>
            </div>
          } @else if (commentedPostsError) {
            <div class="error-container">
              <p class="error-message">{{ commentedPostsError }}</p>
            </div>
          } @else if (commentedPosts.length === 0) {
            <p class="empty-message">Henüz yorum yaptığınız gönderi yok.</p>
          } @else {
            <div class="posts-list">
              @for (post of displayedCommentedPosts; track post.id) {
                <app-post-item
                  [post]="post"
                  [showDeleteButton]="false"
                  [showLikeModal]="true"
                  (postDeleted)="onPostDeleted($event)"
                  (postLiked)="onPostLiked($event)"
                  (commentAdded)="onCommentAdded($event)"
                  (commentDeleted)="onCommentDeleted($event)"
                  (showLikes)="onShowLikes($event)"
                ></app-post-item>
              }
            </div>
            @if (hasMoreCommentedPosts) {
              <div class="show-more-container">
                <p-button
                  label="Daha Fazla Göster"
                  icon="pi pi-arrow-right"
                  iconPos="right"
                  [outlined]="true"
                  (onClick)="onShowMoreCommentedPosts()"
                  class="show-more-button"
                ></p-button>
              </div>
            }
          }
        </div>
      }
      
      @if (activeTab === 'likes') {
        <div class="tab-panel tab-panel-posts">
          @if (isLoadingLikedPosts) {
            <div class="loading-container">
              <p-progressSpinner></p-progressSpinner>
              <p>Beğendiğiniz gönderiler yükleniyor...</p>
            </div>
          } @else if (likedPostsError) {
            <div class="error-container">
              <p class="error-message">{{ likedPostsError }}</p>
            </div>
          } @else if (likedPosts.length === 0) {
            <p class="empty-message">Henüz beğendiğiniz gönderi yok.</p>
          } @else {
            <div class="posts-list">
              @for (post of displayedLikedPosts; track post.id) {
                <app-post-item
                  [post]="post"
                  [showDeleteButton]="false"
                  [showLikeModal]="true"
                  (postDeleted)="onPostDeleted($event)"
                  (postLiked)="onPostLiked($event)"
                  (commentAdded)="onCommentAdded($event)"
                  (commentDeleted)="onCommentDeleted($event)"
                  (showLikes)="onShowLikes($event)"
                ></app-post-item>
              }
            </div>
            @if (hasMoreLikedPosts) {
              <div class="show-more-container">
                <p-button
                  label="Daha Fazla Göster"
                  icon="pi pi-arrow-right"
                  iconPos="right"
                  [outlined]="true"
                  (onClick)="onShowMoreLikedPosts()"
                  class="show-more-button"
                ></p-button>
              </div>
            }
          }
        </div>
      }
    </div>
  </div>
  <p-confirmDialog></p-confirmDialog>
  <p-toast></p-toast>

  <p-dialog
    [(visible)]="showCreatePostModal"
    [modal]="true"
    [style]="{ width: '600px' }"
    [header]="'Yeni Gönderi'"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
  >
    <form [formGroup]="createPostForm" (ngSubmit)="onCreatePost()">
      <div class="create-post-form">
        <div class="form-field">
          <label for="content">Gönderi İçeriği *</label>
          <textarea
            id="content"
            pInputTextarea
            formControlName="content"
            placeholder="Ne düşünüyorsunuz?"
            rows="6"
            [style]="{ width: '100%', resize: 'vertical' }"
            [class.ng-invalid]="createPostForm.get('content')?.invalid && (createPostForm.get('content')?.dirty || createPostForm.get('content')?.touched)"
          ></textarea>
          @if (createPostForm.get('content')?.invalid && (createPostForm.get('content')?.dirty || createPostForm.get('content')?.touched)) {
            <small class="error-text">
              @if (createPostForm.get('content')?.hasError('required')) {
                Bu alan zorunludur.
              } @else if (createPostForm.get('content')?.hasError('maxlength')) {
                Maksimum 255 karakter olmalıdır.
              }
            </small>
          }
        </div>
      </div>
      <div class="create-post-actions">
        <p-button
          label="İptal"
          icon="pi pi-times"
          [outlined]="true"
          type="button"
          (onClick)="onCloseCreatePostModal()"
          [disabled]="isSubmittingPost"
        ></p-button>
        <p-button
          label="Paylaş"
          icon="pi pi-send"
          type="submit"
          [loading]="isSubmittingPost"
          [disabled]="isSubmittingPost || createPostForm.invalid"
        ></p-button>
      </div>
    </form>
  </p-dialog>

  <!-- Likes Modal -->
  <p-dialog
    [(visible)]="showLikesModal"
    [modal]="true"
    [style]="{ width: '500px' }"
    [header]="'Beğenenler'"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    (onHide)="onCloseLikesModal()"
  >
    @if (isLoadingLikes) {
      <div class="loading-container">
        <p-progressSpinner></p-progressSpinner>
        <p>Beğenen kullanıcılar yükleniyor...</p>
      </div>
    } @else if (likesError) {
      <div class="error-container">
        <p class="error-message">{{ likesError }}</p>
      </div>
    } @else if (currentPostLikes.length === 0) {
      <div class="empty-container">
        <p class="empty-message">Henüz beğenen kullanıcı yok.</p>
      </div>
    } @else {
      <div class="likes-list">
        @for (likeUser of currentPostLikes; track likeUser.likeId) {
          <div class="like-user-item">
            <div class="user-avatar-container">
              <img
                [src]="'/img/profilephoto.jpg?userId=' + likeUser.userId"
                [alt]="likeUser.firstName + ' ' + likeUser.lastName"
                class="user-avatar-image"
                (error)="onUserImageError($event, likeUser)"
              />
            </div>
            <div class="user-info">
              <p class="user-name">{{ likeUser.firstName }} {{ likeUser.lastName }}</p>
            </div>
          </div>
        }
      </div>
    }
  </p-dialog>
</p-card>

