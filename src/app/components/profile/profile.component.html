<div class="profile-container">
  @if (isLoading) {
    <div class="loading-container">
      <p-progressSpinner></p-progressSpinner>
      <p>Profil verileri yükleniyor...</p>
    </div>
  } @else if (errorMessage) {
    <div class="error-container">
      <p-message severity="error" [text]="errorMessage"></p-message>
      <p-button label="Yeniden Deneyin" (onClick)="loadProfileData()"></p-button>
    </div>
  } @else {
  <!-- Profile Summary -->
  <app-profile-summary 
    [summary]="profileData.summary"
    [lawyerProfileId]="lawyerProfileId"
    [userProfileId]="userProfileId"
    [friendsCount]="friendsCount"
    (summaryUpdated)="refreshSummary()"
    (showFriends)="onShowFriends()"
  ></app-profile-summary>

  <!-- Profile Tabs (Posts, Comments, Likes) -->
  <app-profile-tabs></app-profile-tabs>

  <div class="profile-content-grid">
    <!-- Left Column -->
    <div class="profile-left-column">
      <!-- Experiences -->
        <app-profile-experiences 
          [experiences]="profileData.experiences"
          [lawyerProfileId]="lawyerProfileId"
          (experienceUpdated)="refreshExperiences()"
          (experienceDeleted)="refreshExperiences()"
        ></app-profile-experiences>

      <!-- Education -->
        <app-profile-education 
          [education]="profileData.education"
          [lawyerProfileId]="lawyerProfileId"
          (educationUpdated)="refreshEducation()"
          (educationDeleted)="refreshEducation()"
        ></app-profile-education>

        <!-- Certificates -->
        <app-profile-certificates 
          [certificates]="profileData.certificates"
          [lawyerProfileId]="lawyerProfileId"
          (certificateUpdated)="refreshCertificates()"
          (certificateDeleted)="refreshCertificates()"
        ></app-profile-certificates>
    </div>

    <!-- Right Column -->
    <div class="profile-right-column">
      <!-- Lawyer Info -->
      @if (profileData.lawyerInfo) {
        <app-profile-lawyer-info 
          [lawyerInfo]="profileData.lawyerInfo"
          [lawyerProfileId]="lawyerProfileId"
          [userProfileId]="userProfileId"
          (lawyerInfoUpdated)="refreshLawyerInfo()"
        ></app-profile-lawyer-info>
      }

      <!-- Skills -->
      <app-profile-skills 
        [lawyerProfileId]="lawyerProfileId"
        (skillDeleted)="refreshSkills()"
      ></app-profile-skills>

      <!-- Address -->
        <app-profile-address 
          [address]="profileData.address"
          [userProfileId]="profileData.address.userProfileId || null"
          (addressUpdated)="refreshAddress()"
        ></app-profile-address>

        <!-- Contact Info -->
        <app-profile-contact 
          [contactInfo]="profileData.contactInfo"
          [lawyerProfileId]="lawyerProfileId"
          (contactUpdated)="refreshContact()"
        ></app-profile-contact>
    </div>
  </div>
  }

  <!-- Friends Modal -->
  <p-dialog
    [(visible)]="showFriendsModal"
    [modal]="true"
    [style]="{ width: '600px', maxWidth: '90vw' }"
    [header]="'Arkadaşlar (' + friendsCount + ')'"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    (onHide)="onCloseFriendsModal()"
    styleClass="friends-modal"
  >
    @if (friends.length === 0) {
      <div class="empty-container">
        <div class="empty-icon">
          <span class="material-symbols-outlined">people</span>
        </div>
        <p class="empty-message">Henüz arkadaş yok.</p>
        <p class="empty-submessage">Arkadaş ekledikçe burada görünecekler.</p>
      </div>
    } @else {
      <div class="friends-list">
        @for (friend of friends; track friend.friendshipId) {
          <div class="friend-card" *ngIf="friend.profile">
            <div class="friend-card-content">
              <div class="user-avatar-container">
                <img
                  [src]="'/img/profilephoto.jpg?userId=' + friend.friendUserId"
                  [alt]="friend.profile.firstName + ' ' + friend.profile.lastName"
                  class="user-avatar-image"
                  (error)="onUserImageError($event, friend)"
                />
                <div class="avatar-border"></div>
              </div>
              <div class="user-info">
                <p class="user-name">{{ friend.profile.firstName }} {{ friend.profile.lastName }}</p>
                <p class="user-email" *ngIf="friend.profile.email">{{ friend.profile.email }}</p>
              </div>
              <div class="friend-actions">
                <button
                  pButton
                  type="button"
                  icon="pi pi-trash"
                  class="p-button-text p-button-danger delete-friend-button"
                  (click)="onDeleteFriend($event, friend)"
                  [title]="'Arkadaşlıktan çıkar'"
                ></button>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </p-dialog>

  <p-confirmDialog></p-confirmDialog>
  <p-toast></p-toast>
</div>

