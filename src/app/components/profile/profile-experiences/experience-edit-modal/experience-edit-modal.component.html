<p-dialog
  [(visible)]="visible"
  (visibleChange)="visibleChange.emit($event)"
  [modal]="true"
  [style]="{ width: '600px' }"
  [draggable]="false"
  [resizable]="false"
  [closable]="true"
>
  <ng-template pTemplate="header">
    <h3 class="dialog-title">{{ isEditMode ? 'Deneyim Düzenle' : 'Yeni Deneyim Ekle' }}</h3>
  </ng-template>
  <form [formGroup]="experienceForm" class="experience-form">
    @if (errorMessage) {
      <p-message severity="error" [text]="errorMessage" styleClass="w-full mb-3"></p-message>
    }

    <div class="form-field">
      <label for="companyName" class="form-label">
        Şirket Adı <span class="required">*</span>
      </label>
      <input
        id="companyName"
        type="text"
        pInputText
        formControlName="companyName"
        class="w-full"
        [class.ng-invalid]="experienceForm.get('companyName')?.invalid && experienceForm.get('companyName')?.touched"
      />
      @if (getErrorMessage('companyName')) {
        <small class="error-text">{{ getErrorMessage('companyName') }}</small>
      }
    </div>

    <div class="form-field">
      <label for="position" class="form-label">
        Pozisyon <span class="required">*</span>
      </label>
      <input
        id="position"
        type="text"
        pInputText
        formControlName="position"
        class="w-full"
        [class.ng-invalid]="experienceForm.get('position')?.invalid && experienceForm.get('position')?.touched"
      />
      @if (getErrorMessage('position')) {
        <small class="error-text">{{ getErrorMessage('position') }}</small>
      }
    </div>

    <div class="form-row">
      <div class="form-field">
        <label for="startDate" class="form-label">
          Başlangıç Tarihi <span class="required">*</span>
        </label>
        <p-datepicker
          id="startDate"
          formControlName="startDate"
          [showIcon]="true"
          dateFormat="mm/yy"
          view="month"
          [maxDate]="today"
          class="w-full"
          [class.ng-invalid]="experienceForm.get('startDate')?.invalid && experienceForm.get('startDate')?.touched"
        ></p-datepicker>
        @if (getErrorMessage('startDate')) {
          <small class="error-text">{{ getErrorMessage('startDate') }}</small>
        }
      </div>

      <div class="form-field">
        <label for="endDate" class="form-label">
          Bitiş Tarihi
        </label>
        <p-datepicker
          id="endDate"
          formControlName="endDate"
          [showIcon]="true"
          dateFormat="mm/yy"
          view="month"
          [maxDate]="today"
          class="w-full"
          [class.ng-invalid]="experienceForm.get('endDate')?.invalid && experienceForm.get('endDate')?.touched"
        ></p-datepicker>
        @if (getErrorMessage('endDate')) {
          <small class="error-text">{{ getErrorMessage('endDate') }}</small>
        }
      </div>
    </div>

    <div class="form-field checkbox-field">
      <label for="isCurrentJob" class="checkbox-label">
        <span class="checkbox-text">Hâlâ bu işte çalışıyorum</span>
      </label>
      <p-checkbox
        formControlName="isCurrentJob"
        inputId="isCurrentJob"
        [binary]="true"
      ></p-checkbox>
    </div>

    <div class="form-field">
      <label for="description" class="form-label">
        Açıklama <span class="required">*</span>
      </label>
      <textarea
        id="description"
        pInputTextarea
        formControlName="description"
        rows="4"
        class="w-full"
        [class.ng-invalid]="experienceForm.get('description')?.invalid && experienceForm.get('description')?.touched"
      ></textarea>
      @if (getErrorMessage('description')) {
        <small class="error-text">{{ getErrorMessage('description') }}</small>
      }
    </div>
  </form>

  <ng-template pTemplate="footer">
    <div class="dialog-footer">
      <div class="footer-left">
        @if (isEditMode) {
          <p-button
            label="Sil"
            icon="pi pi-trash"
            severity="danger"
            [outlined]="true"
            (onClick)="onDelete()"
            [disabled]="isSubmitting"
          ></p-button>
        }
      </div>
      <div class="footer-right">
        <p-button
          label="İptal"
          icon="pi pi-times"
          [outlined]="true"
          (onClick)="onClose()"
          [disabled]="isSubmitting"
        ></p-button>
        <p-button
          [label]="isEditMode ? 'Kaydet' : 'Ekle'"
          icon="pi pi-check"
          (onClick)="onSave()"
          [loading]="isSubmitting"
          [disabled]="isSubmitting || experienceForm.invalid"
        ></p-button>
      </div>
    </div>
  </ng-template>
</p-dialog>

