<div class="posts-list-container">
  <div class="posts-list-header">
    <p-button
      label="Geri"
      icon="pi pi-arrow-left"
      [outlined]="true"
      [text]="true"
      (onClick)="goBack()"
      class="back-button"
    ></p-button>
    <h1 class="page-title">Yorum Yaptığım Gönderiler</h1>
  </div>

  <p-card class="posts-list-card">
    @if (isLoadingCommentedPosts) {
      <div class="loading-container">
        <p-progressSpinner></p-progressSpinner>
        <p>Yorum yaptığınız gönderiler yükleniyor...</p>
      </div>
    } @else if (commentedPostsError) {
      <div class="error-container">
        <p class="error-message">{{ commentedPostsError }}</p>
      </div>
    } @else if (commentedPosts.length === 0) {
      <div class="empty-container">
        <p class="empty-message">Henüz yorum yaptığınız gönderi yok.</p>
      </div>
    } @else {
      <div class="posts-list">
        @for (post of commentedPosts; track post.id) {
          <div class="post-item">
            <div class="post-content">
              <p class="post-text">{{ post.content }}</p>
              <div class="post-meta">
                <span class="post-date">{{ formatDate(post.createdAt) }}</span>
              </div>
            </div>
                  <div class="post-stats">
                    <div class="stat-item stat-item-clickable" (click)="onToggleLike($event, post)">
                      <span class="material-symbols-outlined stat-icon" [class.liked]="isLiked(post)">
                        {{ isLiked(post) ? 'favorite' : 'favorite_border' }}
                      </span>
                      <span class="stat-count">{{ getLikesCount(post) }}</span>
                    </div>
              <div class="stat-item stat-item-clickable" (click)="onToggleComments($event, post)">
                <span class="material-symbols-outlined stat-icon">comment</span>
                <span class="stat-count">{{ getCommentsCount(post) }}</span>
              </div>
            </div>
            @if (isCommentsExpanded(post)) {
              <div class="comments-section">
                <div class="comment-form-container">
                  <form [formGroup]="getCommentForm(post.id)" (ngSubmit)="onSubmitComment(post)">
                    <div class="comment-input-wrapper">
                      <textarea
                        pInputTextarea
                        formControlName="text"
                        placeholder="Yorum yazın..."
                        rows="2"
                        [style]="{ width: '100%', resize: 'vertical' }"
                        [class.ng-invalid]="getCommentForm(post.id).get('text')?.invalid && (getCommentForm(post.id).get('text')?.dirty || getCommentForm(post.id).get('text')?.touched)"
                      ></textarea>
                      <p-button
                        label="Yorum Yap"
                        icon="pi pi-send"
                        type="submit"
                        [loading]="isSubmittingCommentForPost(post.id)"
                        [disabled]="isSubmittingCommentForPost(post.id) || getCommentForm(post.id).invalid"
                        [style]="{ 'margin-top': '8px' }"
                      ></p-button>
                    </div>
                    @if (getCommentForm(post.id).get('text')?.invalid && (getCommentForm(post.id).get('text')?.dirty || getCommentForm(post.id).get('text')?.touched)) {
                      <small class="error-text">
                        @if (getCommentForm(post.id).get('text')?.hasError('required')) {
                          Bu alan zorunludur.
                        } @else if (getCommentForm(post.id).get('text')?.hasError('maxlength')) {
                          Maksimum 255 karakter olmalıdır.
                        }
                      </small>
                    }
                  </form>
                </div>
                @if (getComments(post).length === 0) {
                  <p class="empty-comments-message">Henüz yorum yok.</p>
                } @else {
                  <div class="comments-list">
                    @for (comment of getComments(post); track comment.id) {
                      <div class="comment-item">
                        <span 
                          class="material-symbols-outlined comment-delete-icon"
                          (click)="onDeleteComment($event, post, comment)"
                          title="Sil"
                        >delete</span>
                        <div class="comment-header">
                          <span class="comment-user-id">Kullanıcı ID: {{ comment.userId }}</span>
                          <span class="comment-date">{{ formatDate(comment.createdAt) }}</span>
                        </div>
                        <p class="comment-text">{{ comment.text }}</p>
                      </div>
                    }
                  </div>
                }
              </div>
            }
          </div>
        }
      </div>
    }
  </p-card>
  <p-confirmDialog></p-confirmDialog>
  <p-toast></p-toast>
</div>

